<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Rotina</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Minha Rotina">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: calc(100vh - 20px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .date-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #4facfe;
            border-bottom: 3px solid #4facfe;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .content {
            padding: 20px;
            min-height: 400px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #4facfe;
            margin-right: 10px;
            border-radius: 2px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            font-size: 16px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .lembrete-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .lembrete-item.concluido {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .lembrete-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .lembrete-titulo {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .lembrete-status {
            display: flex;
            gap: 8px;
        }

        .btn-pequeno {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-concluir {
            background: #28a745;
            color: white;
        }

        .btn-excluir {
            background: #dc3545;
            color: white;
        }

        .lembrete-info {
            font-size: 14px;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alerta-lembretes {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .alerta-hoje {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #333;
        }

        .exercicio-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #4facfe;
        }

        .exercicio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .exercicio-nome {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .exercicio-series {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .carga-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .carga-input input {
            width: 60px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .carga-ultima {
            font-size: 12px;
            color: #28a745;
            font-weight: 600;
        }

        .treino-config {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }

        .treino-titulo {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .dia-semana {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .dia-semana select {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .resumo-macros {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .resumo-macro {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
        }

        .resumo-macro .valor {
            font-size: 18px;
            display: block;
            margin-bottom: 2px;
        }

        .resumo-macro .label {
            font-size: 12px;
            opacity: 0.8;
        }

        .resumo-calorias {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .resumo-insulina {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 8px;
            border-radius: 8px;
        }

        .sub-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sub-tab.active {
            background: white;
            color: #4facfe;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sub-content {
            display: none;
        }

        .sub-content.active {
            display: block;
        }

        .refeicao-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .refeicao-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .refeicao-nome {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .refeicao-horario {
            font-size: 14px;
            color: #28a745;
            font-weight: 600;
        }

        .refeicao-macros {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 8px 0;
            font-size: 12px;
        }

        .macro-item {
            text-align: center;
            padding: 4px;
            border-radius: 4px;
            background: #f8f9fa;
        }

        .carbs { background: #e3f2fd; color: #1976d2; }
        .protein { background: #e8f5e8; color: #388e3c; }
        .fat { background: #fff3e0; color: #f57c00; }

        .refeicao-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
            margin-top: 8px;
        }

        .insulina-info {
            background: #dc3545;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        .refeicao-config {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }

        .input-grupo {
            margin-bottom: 10px;
        }

        .input-grupo label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .input-grupo input, .input-grupo textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .macros-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .urgente {
            border-left: 4px solid #dc3545;
        }

        .hoje {
            border-left: 4px solid #ffc107;
        }

        /* Responsividade para iPhone */
        @media (max-width: 380px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .tab {
                font-size: 11px;
                padding: 12px 8px;
            }
        }

        /* Estilo para modo escuro do iOS */
        @media (prefers-color-scheme: dark) {
            .container {
                background: #1c1c1e;
                color: white;
            }
            
            .card {
                background: #2c2c2e;
                border-color: #3a3a3c;
            }
            
            .tabs {
                background: #2c2c2e;
                border-color: #3a3a3c;
            }
            
            .tab {
                color: #8e8e93;
            }
            
            .section-title {
                color: white;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Minha Rotina</h1>
            <div class="date-info" id="dateInfo"></div>
            <div id="alertaLembretes" style="margin-top: 10px; display: none;"></div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('lembretes')">
                📋 Lembretes
            </button>
            <button class="tab" onclick="showTab('rotina')">
                💪 Rotina
            </button>
            <button class="tab" onclick="showTab('financeiro')">
                💰 Financeiro
            </button>
        </div>

        <div class="content">
            <!-- ABA LEMBRETES -->
            <div id="lembretes" class="tab-content active">
                <div class="section-title">Meus Lembretes</div>
                
                <!-- Formulário para adicionar lembrete -->
                <div class="card" id="formLembrete" style="display: none;">
                    <h3 style="margin-bottom: 15px; color: #4facfe;">➕ Novo Lembrete</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Tarefa:</label>
                        <input type="text" id="tarefaInput" placeholder="Ex: Consulta médica" 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Data:</label>
                        <input type="date" id="dataInput" 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Horário:</label>
                        <input type="time" id="horarioInput" 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="salvarLembrete()" style="flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                            ✅ Salvar
                        </button>
                        <button class="btn" onclick="cancelarLembrete()" style="flex: 1; background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">
                            ❌ Cancelar
                        </button>
                    </div>
                </div>
                
                <!-- Lista de lembretes -->
                <div id="listaLembretes"></div>
                
                <!-- Estado vazio -->
                <div class="empty-state" id="emptyState">
                    <span class="icon">📝</span>
                    <h3>Nenhum lembrete ainda</h3>
                    <p>Adicione suas tarefas e organize seu dia!</p>
                </div>

                <button class="btn" onclick="mostrarFormLembrete()">
                    + Adicionar Lembrete
                </button>
            </div>

            <!-- ABA ROTINA -->
            <div id="rotina" class="tab-content">
                <div class="section-title">Rotina de Hoje</div>
                
                <!-- Abas dentro da Rotina -->
                <div style="display: flex; background: #f8f9fa; border-radius: 10px; padding: 4px; margin-bottom: 15px;">
                    <button id="btnTreino" class="sub-tab active" onclick="mostrarSubAba('treino')">
                        💪 Treino
                    </button>
                    <button id="btnRefeicoes" class="sub-tab" onclick="mostrarSubAba('refeicoes')">
                        🍽️ Refeições
                    </button>
                </div>
                
                <!-- Resumo Nutricional -->
                <div id="resumoNutricional" class="card" style="margin-bottom: 20px; display: none;">
                    <h4 style="color: #28a745; margin: 0 0 15px 0; text-align: center;">📊 Resumo Nutricional do Dia</h4>
                    <div id="conteudoResumo"></div>
                </div>
                
                <!-- Conteúdo do Treino -->
                <div id="subTreino" class="sub-content active">
                    <div class="card">
                        <div id="treinoHoje"></div>
                    </div>
                    <button class="btn" onclick="mostrarConfigTreinos()">
                        ⚙️ Configurar Treinos
                    </button>
                </div>
                
                <!-- Conteúdo das Refeições -->
                <div id="subRefeicoes" class="sub-content">
                    <div class="card">
                        <div id="refeicoesHoje"></div>
                    </div>
                    <button class="btn" onclick="mostrarConfigRefeicoes()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                        ⚙️ Configurar Refeições
                    </button>
                </div>
                
                <!-- Modal de Configuração de Treinos -->
                <div id="modalTreinos" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
                    <div style="background: white; margin: 20px; border-radius: 15px; max-height: calc(100vh - 40px); overflow-y: auto;">
                        <div style="padding: 20px; border-bottom: 1px solid #eee;">
                            <h2 style="color: #4facfe; margin: 0;">⚙️ Configurar Treinos</h2>
                        </div>
                        
                        <div style="padding: 20px;">
                            <!-- Configuração dos dias da semana -->
                            <h3 style="color: #333; margin-bottom: 15px;">📅 Dias da Semana</h3>
                            <div id="diasSemana"></div>
                            
                            <!-- Configuração dos treinos -->
                            <h3 style="color: #333; margin: 20px 0 15px 0;">💪 Seus Treinos</h3>
                            <div id="listaTreinos"></div>
                            
                            <button class="btn" onclick="adicionarTreino()" style="margin: 15px 0; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                + Adicionar Novo Treino
                            </button>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="btn" onclick="salvarConfigTreinos()" style="flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                    ✅ Salvar
                                </button>
                                <button class="btn" onclick="fecharConfigTreinos()" style="flex: 1; background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">
                                    ❌ Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal de Configuração de Refeições -->
                <div id="modalRefeicoes" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
                    <div style="background: white; margin: 20px; border-radius: 15px; max-height: calc(100vh - 40px); overflow-y: auto;">
                        <div style="padding: 20px; border-bottom: 1px solid #eee;">
                            <h2 style="color: #28a745; margin: 0;">🍽️ Configurar Refeições</h2>
                        </div>
                        
                        <div style="padding: 20px;">
                            <!-- Lista de refeições -->
                            <div id="listaRefeicoes"></div>
                            
                            <button class="btn" onclick="adicionarRefeicao()" style="margin: 15px 0; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                + Adicionar Nova Refeição
                            </button>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="btn" onclick="salvarConfigRefeicoes()" style="flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                    ✅ Salvar
                                </button>
                                <button class="btn" onclick="fecharConfigRefeicoes()" style="flex: 1; background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">
                                    ❌ Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA FINANCEIRO -->
            <div id="financeiro" class="tab-content">
                <div class="section-title">Controle Financeiro</div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #4facfe;">💵 Resumo do Mês</h3>
                    <div class="empty-state">
                        <span class="icon">📊</span>
                        <h3>Configure suas finanças</h3>
                        <p>Defina salário, custos fixos e metas</p>
                    </div>
                </div>

                <button class="btn" onclick="alert('Em breve: Configurar finanças!')">
                    ⚙️ Configurar Finanças
                </button>
            </div>
        </div>
    </div>

    <script>
        // Função para mostrar a data atual
        function updateDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateString = now.toLocaleDateString('pt-BR', options);
            document.getElementById('dateInfo').textContent = dateString;
        }

        // Função para trocar entre abas
        function showTab(tabName) {
            // Remover classe active de todas as abas
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            // Adicionar classe active na aba selecionada
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // FUNÇÕES DOS LEMBRETES
        let lembretes = JSON.parse(localStorage.getItem('lembretes')) || [];

        function mostrarFormLembrete() {
            document.getElementById('formLembrete').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            
            // Definir data padrão como hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataInput').value = hoje;
        }

        function cancelarLembrete() {
            document.getElementById('formLembrete').style.display = 'none';
            document.getElementById('tarefaInput').value = '';
            document.getElementById('dataInput').value = '';
            document.getElementById('horarioInput').value = '';
            atualizarListaLembretes();
        }

        function salvarLembrete() {
            const tarefa = document.getElementById('tarefaInput').value.trim();
            const data = document.getElementById('dataInput').value;
            const horario = document.getElementById('horarioInput').value;
            
            if (!tarefa) {
                alert('Por favor, digite a tarefa!');
                return;
            }
            
            if (!data) {
                alert('Por favor, selecione a data!');
                return;
            }
            
            if (!horario) {
                alert('Por favor, selecione o horário!');
                return;
            }
            
            const novoLembrete = {
                id: Date.now(),
                tarefa: tarefa,
                data: data,
                horario: horario,
                concluido: false,
                criado: new Date().toISOString()
            };
            
            lembretes.push(novoLembrete);
            localStorage.setItem('lembretes', JSON.stringify(lembretes));
            
            // Agendar notificação
            agendarNotificacao(novoLembrete);
            
            cancelarLembrete();
            atualizarListaLembretes();
        }

        function atualizarListaLembretes() {
            const lista = document.getElementById('listaLembretes');
            const emptyState = document.getElementById('emptyState');
            
            if (lembretes.length === 0) {
                lista.innerHTML = '';
                emptyState.style.display = 'block';
                verificarLembretesUrgentes();
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Ordenar por data e horário
            const lembretesOrdenados = lembretes.sort((a, b) => {
                const dataA = new Date(a.data + ' ' + a.horario);
                const dataB = new Date(b.data + ' ' + b.horario);
                return dataA - dataB;
            });
            
            lista.innerHTML = lembretesOrdenados.map(lembrete => {
                const dataLembrete = new Date(lembrete.data + ' ' + lembrete.horario);
                const hoje = new Date();
                const amanha = new Date(hoje);
                amanha.setDate(hoje.getDate() + 1);
                
                let classeUrgencia = '';
                if (dataLembrete < hoje && !lembrete.concluido) {
                    classeUrgencia = 'urgente';
                } else if (lembrete.data === hoje.toISOString().split('T')[0]) {
                    classeUrgencia = 'hoje';
                }
                
                const dataFormatada = new Date(lembrete.data).toLocaleDateString('pt-BR');
                
                return `
                    <div class="lembrete-item ${classeUrgencia} ${lembrete.concluido ? 'concluido' : ''}">
                        <div class="lembrete-header">
                            <div class="lembrete-titulo">${lembrete.tarefa}</div>
                            <div class="lembrete-status">
                                ${!lembrete.concluido ? 
                                    `<button class="btn-pequeno btn-concluir" onclick="concluirLembrete(${lembrete.id})">✓</button>` : 
                                    ''
                                }
                                <button class="btn-pequeno btn-excluir" onclick="excluirLembrete(${lembrete.id})">🗑️</button>
                            </div>
                        </div>
                        <div class="lembrete-info">
                            <span>📅 ${dataFormatada}</span>
                            <span>⏰ ${lembrete.horario}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            verificarLembretesUrgentes();
        }

        function concluirLembrete(id) {
            lembretes = lembretes.map(lembrete => 
                lembrete.id === id ? {...lembrete, concluido: true} : lembrete
            );
            localStorage.setItem('lembretes', JSON.stringify(lembretes));
            atualizarListaLembretes();
        }

        function excluirLembrete(id) {
            if (confirm('Tem certeza que deseja excluir este lembrete?')) {
                lembretes = lembretes.filter(lembrete => lembrete.id !== id);
                localStorage.setItem('lembretes', JSON.stringify(lembretes));
                atualizarListaLembretes();
            }
        }

        // FUNÇÕES DOS TREINOS
        let treinos = JSON.parse(localStorage.getItem('treinos')) || [];
        let diasSemanaConfig = JSON.parse(localStorage.getItem('diasSemanaConfig')) || {};
        let historicoCargas = JSON.parse(localStorage.getItem('historicoCargas')) || {};

        const diasSemana = ['domingo', 'segunda', 'terça', 'quarta', 'quinta', 'sexta', 'sábado'];

        function mostrarConfigTreinos() {
            document.getElementById('modalTreinos').style.display = 'block';
            carregarConfigTreinos();
        }

        function fecharConfigTreinos() {
            document.getElementById('modalTreinos').style.display = 'none';
        }

        function carregarConfigTreinos() {
            // Carregar dias da semana
            const diasDiv = document.getElementById('diasSemana');
            diasDiv.innerHTML = diasSemana.map((dia, index) => `
                <div class="dia-semana">
                    <strong style="width: 80px;">${dia.charAt(0).toUpperCase() + dia.slice(1)}:</strong>
                    <span style="font-size: 12px; color: #6c757d; width: 60px;">(${index === 0 ? 'Dom' : index === 1 ? 'Seg' : index === 2 ? 'Ter' : index === 3 ? 'Qua' : index === 4 ? 'Qui' : index === 5 ? 'Sex' : 'Sáb'})</span>
                    <select id="select-${dia}">
                        <option value="">Descanso</option>
                        ${treinos.map(treino => 
                            `<option value="${treino.id}" ${diasSemanaConfig[dia] === treino.id ? 'selected' : ''}>
                                ${treino.nome}
                            </option>`
                        ).join('')}
                    </select>
                </div>
            `).join('');

            // Carregar treinos
            const treinosDiv = document.getElementById('listaTreinos');
            if (treinos.length === 0) {
                treinosDiv.innerHTML = '<p style="text-align: center; color: #6c757d;">Nenhum treino cadastrado ainda</p>';
                return;
            }

            treinosDiv.innerHTML = treinos.map(treino => `
                <div class="treino-config">
                    <div class="treino-titulo">
                        <h4 style="color: #4facfe; margin: 0;">${treino.nome}</h4>
                        <button onclick="excluirTreino('${treino.id}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">🗑️</button>
                    </div>
                    <div id="exercicios-${treino.id}">
                        ${treino.exercicios.map((ex, index) => `
                            <div style="margin-bottom: 10px; padding: 8px; background: white; border-radius: 4px;">
                                <input type="text" value="${ex.nome}" placeholder="Nome do exercício" 
                                       onchange="atualizarExercicio('${treino.id}', ${index}, 'nome', this.value)"
                                       style="width: 100%; padding: 6px; margin-bottom: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                <div style="display: flex; gap: 10px;">
                                    <input type="number" value="${ex.series}" placeholder="Séries" 
                                           onchange="atualizarExercicio('${treino.id}', ${index}, 'series', this.value)"
                                           style="width: 60px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                    <span style="display: flex; align-items: center;">x</span>
                                    <input type="number" value="${ex.repeticoes}" placeholder="Reps" 
                                           onchange="atualizarExercicio('${treino.id}', ${index}, 'repeticoes', this.value)"
                                           style="width: 60px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                    <button onclick="removerExercicio('${treino.id}', ${index})" 
                                            style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">❌</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="adicionarExercicio('${treino.id}')" 
                            style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 12px; margin-top: 8px;">
                        + Adicionar Exercício
                    </button>
                </div>
            `).join('');
        }

        function adicionarTreino() {
            const nome = prompt('Nome do treino (ex: Treino A, Peito/Tríceps):');
            if (!nome) return;

            const novoTreino = {
                id: Date.now().toString(),
                nome: nome,
                exercicios: []
            };

            treinos.push(novoTreino);
            carregarConfigTreinos();
        }

        function excluirTreino(id) {
            if (confirm('Tem certeza que deseja excluir este treino?')) {
                treinos = treinos.filter(t => t.id !== id);
                carregarConfigTreinos();
            }
        }

        function adicionarExercicio(treinoId) {
            const treino = treinos.find(t => t.id === treinoId);
            if (treino) {
                treino.exercicios.push({
                    nome: '',
                    series: 4,
                    repeticoes: 12
                });
                carregarConfigTreinos();
            }
        }

        function removerExercicio(treinoId, index) {
            const treino = treinos.find(t => t.id === treinoId);
            if (treino) {
                treino.exercicios.splice(index, 1);
                carregarConfigTreinos();
            }
        }

        function atualizarExercicio(treinoId, index, campo, valor) {
            const treino = treinos.find(t => t.id === treinoId);
            if (treino && treino.exercicios[index]) {
                treino.exercicios[index][campo] = valor;
            }
        }

        function salvarConfigTreinos() {
            // Salvar configuração dos dias
            diasSemana.forEach(dia => {
                const select = document.getElementById(`select-${dia}`);
                if (select) {
                    diasSemanaConfig[dia] = select.value;
                }
            });

            localStorage.setItem('treinos', JSON.stringify(treinos));
            localStorage.setItem('diasSemanaConfig', JSON.stringify(diasSemanaConfig));
            
            fecharConfigTreinos();
            atualizarTreinoHoje();
            alert('Configuração salva com sucesso!');
        }

        function atualizarTreinoHoje() {
            const hoje = new Date().getDay(); // 0=domingo, 1=segunda...
            const nomeDia = diasSemana[hoje];
            const treinoId = diasSemanaConfig[nomeDia];
            
            const treinoDiv = document.getElementById('treinoHoje');
            
            if (!treinoId) {
                treinoDiv.innerHTML = `
                    <div class="empty-state">
                        <span class="icon">😴</span>
                        <h3>Hoje é dia de descanso!</h3>
                        <p>${nomeDia.charAt(0).toUpperCase() + nomeDia.slice(1)}</p>
                    </div>
                `;
                return;
            }
            
            const treino = treinos.find(t => t.id === treinoId);
            if (!treino || treino.exercicios.length === 0) {
                treinoDiv.innerHTML = `
                    <div class="empty-state">
                        <span class="icon">💪</span>
                        <h3>Configure seus treinos</h3>
                        <p>Adicione exercícios ao treino de ${nomeDia}</p>
                    </div>
                `;
                return;
            }
            
            treinoDiv.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <h4 style="color: #4facfe; margin: 0 0 5px 0;">${treino.nome}</h4>
                    <p style="color: #6c757d; margin: 0; font-size: 14px;">${nomeDia.charAt(0).toUpperCase() + nomeDia.slice(1)}</p>
                </div>
                ${treino.exercicios.map((exercicio, index) => {
                    const chaveHistorico = `${treinoId}-${index}`;
                    const ultimaCarga = historicoCargas[chaveHistorico] || '';
                    
                    return `
                        <div class="exercicio-item">
                            <div class="exercicio-header">
                                <div class="exercicio-nome">${exercicio.nome}</div>
                            </div>
                            <div class="exercicio-series">${exercicio.series} séries x ${exercicio.repeticoes} repetições</div>
                            <div class="carga-input">
                                <span style="font-size: 14px; color: #333;">Carga:</span>
                                <input type="number" id="carga-${chaveHistorico}" placeholder="kg" step="0.5">
                                <button onclick="salvarCarga('${chaveHistorico}')" 
                                        style="background: #4facfe; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">✓</button>
                            </div>
                            ${ultimaCarga ? `<div class="carga-ultima">Última: ${ultimaCarga}kg</div>` : ''}
                        </div>
                    `;
                }).join('')}
            `;
        }

        // FUNÇÕES DAS REFEIÇÕES
        let refeicoes = JSON.parse(localStorage.getItem('refeicoes')) || [];

        function calcularInsulina(carboidratos, insulinaPorCarb) {
            if (!carboidratos || !insulinaPorCarb) return 0;
            const resultado = carboidratos / insulinaPorCarb;
            const decimal = resultado % 1;
            
            if (decimal >= 0.5) {
                return Math.ceil(resultado);
            } else {
                return Math.floor(resultado);
            }
        }

        function atualizarResumoNutricional() {
            const resumoDiv = document.getElementById('resumoNutricional');
            const conteudoDiv = document.getElementById('conteudoResumo');
            
            if (refeicoes.length === 0) {
                resumoDiv.style.display = 'none';
                return;
            }
            
            // Calcular totais
            let totalCalorias = 0;
            let totalCarboidratos = 0;
            let totalProteinas = 0;
            let totalGorduras = 0;
            let totalInsulina = 0;
            
            refeicoes.forEach(refeicao => {
                totalCalorias += Number(refeicao.calorias) || 0;
                totalCarboidratos += Number(refeicao.carboidratos) || 0;
                totalProteinas += Number(refeicao.proteinas) || 0;
                totalGorduras += Number(refeicao.gorduras) || 0;
                totalInsulina += calcularInsulina(refeicao.carboidratos, refeicao.insulinaPorCarb || 10);
            });
            
            conteudoDiv.innerHTML = `
                <div class="resumo-calorias">
                    <div style="font-size: 20px; font-weight: bold;">🔥 ${totalCalorias} kcal</div>
                    <div style="font-size: 12px; opacity: 0.9;">Total do dia</div>
                </div>
                
                <div class="resumo-macros">
                    <div class="resumo-macro carbs">
                        <span class="valor">${totalCarboidratos}g</span>
                        <span class="label">Carboidratos</span>
                    </div>
                    <div class="resumo-macro protein">
                        <span class="valor">${totalProteinas}g</span>
                        <span class="label">Proteínas</span>
                    </div>
                    <div class="resumo-macro fat">
                        <span class="valor">${totalGorduras}g</span>
                        <span class="label">Gorduras</span>
                    </div>
                </div>
                
                <div class="resumo-insulina">
                    <div style="font-size: 16px; font-weight: bold;">💉 ${totalInsulina} unidade${totalInsulina !== 1 ? 's' : ''} de insulina</div>
                    <div style="font-size: 11px; opacity: 0.9;">Total do dia</div>
                </div>
            `;
            
            resumoDiv.style.display = 'block';
        }

        function mostrarSubAba(aba) {
            // Remover classe active de todas as sub-abas
            document.querySelectorAll('.sub-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.sub-content').forEach(content => content.classList.remove('active'));
            
            // Adicionar classe active na aba selecionada
            document.getElementById('btn' + aba.charAt(0).toUpperCase() + aba.slice(1)).classList.add('active');
            document.getElementById('sub' + aba.charAt(0).toUpperCase() + aba.slice(1)).classList.add('active');
            
            // Mostrar/ocultar resumo nutricional apenas na aba de refeições
            const resumoDiv = document.getElementById('resumoNutricional');
            if (aba === 'refeicoes') {
                atualizarResumoNutricional();
            } else {
                resumoDiv.style.display = 'none';
            }
        }

        function mostrarConfigRefeicoes() {
            document.getElementById('modalRefeicoes').style.display = 'block';
            carregarConfigRefeicoes();
        }

        function fecharConfigRefeicoes() {
            document.getElementById('modalRefeicoes').style.display = 'none';
        }

        function carregarConfigRefeicoes() {
            const refeicoesDiv = document.getElementById('listaRefeicoes');
            
            if (refeicoes.length === 0) {
                refeicoesDiv.innerHTML = '<p style="text-align: center; color: #6c757d;">Nenhuma refeição cadastrada ainda</p>';
                return;
            }

            refeicoesDiv.innerHTML = refeicoes.map(refeicao => `
                <div class="refeicao-config">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: #28a745; margin: 0;">Refeição</h4>
                        <button onclick="excluirRefeicao('${refeicao.id}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">🗑️</button>
                    </div>
                    
                    <div class="input-grupo">
                        <label>Nome da refeição:</label>
                        <input type="text" value="${refeicao.nome}" onchange="atualizarRefeicao('${refeicao.id}', 'nome', this.value)" placeholder="Ex: Café da manhã">
                    </div>
                    
                    <div class="input-grupo">
                        <label>Horário:</label>
                        <input type="time" value="${refeicao.horario}" onchange="atualizarRefeicao('${refeicao.id}', 'horario', this.value)">
                    </div>
                    
                    <div class="input-grupo">
                        <label>Alimentos:</label>
                        <textarea rows="3" onchange="atualizarRefeicao('${refeicao.id}', 'alimentos', this.value)" placeholder="Ex: 2 fatias de pão integral, 1 ovo, 200ml de leite">${refeicao.alimentos}</textarea>
                    </div>
                    
                    <div class="macros-grid">
                        <div class="input-grupo">
                            <label>Carboidratos:</label>
                            <input type="number" value="${refeicao.carboidratos}" onchange="atualizarRefeicao('${refeicao.id}', 'carboidratos', this.value)" step="0.1">
                        </div>
                        <div class="input-grupo">
                            <label>Proteínas:</label>
                            <input type="number" value="${refeicao.proteinas}" onchange="atualizarRefeicao('${refeicao.id}', 'proteinas', this.value)" step="0.1">
                        </div>
                        <div class="input-grupo">
                            <label>Gorduras:</label>
                            <input type="number" value="${refeicao.gorduras}" onchange="atualizarRefeicao('${refeicao.id}', 'gorduras', this.value)" step="0.1">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="input-grupo">
                            <label>Calorias:</label>
                            <input type="number" value="${refeicao.calorias}" onchange="atualizarRefeicao('${refeicao.id}', 'calorias', this.value)">
                        </div>
                        <div class="input-grupo">
                            <label>Carboidratos por UI:</label>
                            <input type="number" value="${refeicao.insulinaPorCarb || 10}" onchange="atualizarRefeicao('${refeicao.id}', 'insulinaPorCarb', this.value)" step="0.1" min="0.1">
                        </div>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; margin-top: 10px; text-align: center;">
                        <strong style="color: #1976d2;">Insulina: ${calcularInsulina(refeicao.carboidratos, refeicao.insulinaPorCarb || 10)} unidade${calcularInsulina(refeicao.carboidratos, refeicao.insulinaPorCarb || 10) !== 1 ? 's' : ''}</strong>
                        <br><small style="color: #666;">1 unidade para cada ${refeicao.insulinaPorCarb || 10}g de carboidrato</small>
                    </div>
                </div>
            `).join('');
        }

        function adicionarRefeicao() {
            const novaRefeicao = {
                id: Date.now().toString(),
                nome: '',
                horario: '08:00',
                alimentos: '',
                carboidratos: 0,
                proteinas: 0,
                gorduras: 0,
                calorias: 0,
                insulinaPorCarb: 10
            };

            refeicoes.push(novaRefeicao);
            carregarConfigRefeicoes();
        }

        function excluirRefeicao(id) {
            if (confirm('Tem certeza que deseja excluir esta refeição?')) {
                refeicoes = refeicoes.filter(r => r.id !== id);
                carregarConfigRefeicoes();
            }
        }

        function atualizarRefeicao(id, campo, valor) {
            const refeicao = refeicoes.find(r => r.id === id);
            if (refeicao) {
                refeicao[campo] = valor;
                // Recarregar para atualizar o cálculo de insulina
                if (campo === 'carboidratos' || campo === 'insulinaPorCarb') {
                    carregarConfigRefeicoes();
                }
            }
        }

        function salvarConfigRefeicoes() {
            localStorage.setItem('refeicoes', JSON.stringify(refeicoes));
            fecharConfigRefeicoes();
            atualizarRefeicoesHoje();
            atualizarResumoNutricional();
            alert('Refeições salvas com sucesso!');
        }

        function atualizarRefeicoesHoje() {
            const refeicoesDiv = document.getElementById('refeicoesHoje');
            
            if (refeicoes.length === 0) {
                refeicoesDiv.innerHTML = `
                    <div class="empty-state">
                        <span class="icon">🥗</span>
                        <h3>Configure suas refeições</h3>
                        <p>Defina seus horários e cardápio diário</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por horário
            const refeicoesOrdenadas = refeicoes.sort((a, b) => {
                return a.horario.localeCompare(b.horario);
            });
            
            const agora = new Date();
            const horaAtual = agora.getHours() * 60 + agora.getMinutes();
            
            refeicoesDiv.innerHTML = refeicoesOrdenadas.map(refeicao => {
                const [hora, minuto] = refeicao.horario.split(':').map(Number);
                const horarioRefeicao = hora * 60 + minuto;
                const insulina = calcularInsulina(refeicao.carboidratos, refeicao.insulinaPorCarb || 10);
                
                // Determinar se é próxima refeição (próxima 30 min)
                const isProxima = horarioRefeicao > horaAtual && horarioRefeicao <= horaAtual + 30;
                const isPendente = horarioRefeicao > horaAtual;
                
                return `
                    <div class="refeicao-item ${isProxima ? 'hoje' : ''}">
                        <div class="refeicao-header">
                            <div class="refeicao-nome">
                                ${refeicao.nome}
                                ${isProxima ? ' 🔔' : ''}
                                ${!isPendente ? ' ✅' : ''}
                            </div>
                            <div class="refeicao-horario">${refeicao.horario}</div>
                        </div>
                        
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px; white-space: pre-line;">
                            ${refeicao.alimentos}
                        </div>
                        
                        <div class="refeicao-macros">
                            <div class="macro-item carbs">
                                <div>Carbs</div>
                                <strong>${refeicao.carboidratos}g</strong>
                            </div>
                            <div class="macro-item protein">
                                <div>Prot</div>
                                <strong>${refeicao.proteinas}g</strong>
                            </div>
                            <div class="macro-item fat">
                                <div>Gord</div>
                                <strong>${refeicao.gorduras}g</strong>
                            </div>
                        </div>
                        
                        <div class="refeicao-info">
                            <span>🔥 ${refeicao.calorias} kcal</span>
                            <div class="insulina-info">💉 ${insulina} unidade${insulina !== 1 ? 's' : ''}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Atualizar resumo se estivermos na aba de refeições
            const btnRefeicoes = document.getElementById('btnRefeicoes');
            if (btnRefeicoes && btnRefeicoes.classList.contains('active')) {
                atualizarResumoNutricional();
            }
        }

        function salvarCarga(chaveHistorico) {
            const input = document.getElementById(`carga-${chaveHistorico}`);
            const carga = input.value;
            
            if (carga) {
                historicoCargas[chaveHistorico] = carga;
                localStorage.setItem('historicoCargas', JSON.stringify(historicoCargas));
                input.value = '';
                atualizarTreinoHoje();
            }
        }

        function verificarLembretesUrgentes() {
            const agora = new Date();
            const hoje = agora.toISOString().split('T')[0];
            const horaAtual = agora.getHours() * 60 + agora.getMinutes();
            
            const atrasados = lembretes.filter(l => {
                if (l.concluido) return false;
                
                const dataLembrete = new Date(l.data + ' ' + l.horario);
                return dataLembrete < agora;
            });
            
            const hojeRestante = lembretes.filter(l => {
                if (l.concluido || l.data !== hoje) return false;
                
                const [hora, minuto] = l.horario.split(':').map(Number);
                const horarioLembrete = hora * 60 + minuto;
                return horarioLembrete > horaAtual;
            });
            
            const alertaDiv = document.getElementById('alertaLembretes');
            
            if (atrasados.length > 0) {
                alertaDiv.innerHTML = `
                    <div class="alerta-lembretes">
                        🚨 ${atrasados.length} tarefa${atrasados.length > 1 ? 's' : ''} atrasada${atrasados.length > 1 ? 's' : ''}!
                    </div>
                `;
                alertaDiv.style.display = 'block';
            } else if (hojeRestante.length > 0) {
                alertaDiv.innerHTML = `
                    <div class="alerta-lembretes alerta-hoje">
                        📅 ${hojeRestante.length} tarefa${hojeRestante.length > 1 ? 's' : ''} para hoje
                    </div>
                `;
                alertaDiv.style.display = 'block';
            } else {
                alertaDiv.style.display = 'none';
            }
        }

        function agendarNotificacao(lembrete) {
            // Manter a função original por compatibilidade
            // mas focar nos alertas visuais
            if ('Notification' in window && Notification.permission === 'granted') {
                const dataNotificacao = new Date(lembrete.data + ' ' + lembrete.horario);
                const agora = new Date();
                const tempoAteNotificacao = dataNotificacao.getTime() - agora.getTime();
                
                if (tempoAteNotificacao > 0 && tempoAteNotificacao < 24 * 60 * 60 * 1000) { // Só até 24h
                    setTimeout(() => {
                        new Notification('🔔 Lembrete!', {
                            body: lembrete.tarefa,
                            icon: '📋',
                            tag: 'lembrete-' + lembrete.id
                        });
                    }, tempoAteNotificacao);
                }
            }
        }

        // Inicializar app
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            atualizarListaLembretes();
            verificarLembretesUrgentes();
            atualizarTreinoHoje();
            atualizarRefeicoesHoje();
            
            // Solicitar permissão para notificações
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Notificações permitidas!');
                    }
                });
            }
        });

        // Atualizar verificações periodicamente
        setInterval(() => {
            updateDate();
            verificarLembretesUrgentes();
        }, 60000);
    </script>
</body>
</html>
